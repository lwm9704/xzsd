<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.demo.shop.dao.ShopDao">

    <!--检验该门店是否已经存在-->
    <select id="countShop" parameterType="com.xzsd.pc.shop.entity.ShopInfoU" resultType="int">
        select count(shop_name)
        from t_shop
        where shop_nam = #{shopName}
        and is_delete = 0
    </select>

    <!--新增门店-->
    <insert id="addShop" parameterType="com.xzsd.pc.shop.entity.ShopInfoU">
        insert into t_shop
        (shop_name,
        phone,
        shoppower_id,
        license,
        province_value,
        city_value,
        county_value,
        address,
        is_delete,
        creat_by,
        creat_time,
        last_modify_by,
        modify_time,
        version)
        value
        (#{shopName},
        #{phone},
        #{shoppowerId},
        #{license},
        #{provinceValue},
        #{cityValue},
        #{countyValue},
        #{address},
        0,
        #{byUserId},
        now(),
        #{byUserId},
        now(),
        0)
    </insert>

    <!--修改门店信息-->
    <update id="updateShop" parameterType="com.xzsd.pc.shop.entity.ShopInfoU">
        update t_shop
        set
            shop_name = #{shopName},
            phone = #{phone},
            shoppower_id = #{shoppowerId},
            license = #{license},
            province_value = #{provinceValue},
            city_value = #{cityValue},
            county_value = #{countyValue},
            address = #{address},
            last_modify_by = #{byUserId},
            modify_time = now(),
            version = version + 1
            where shop_id = #{shopId}
            and version = #{version}
    </update>

    <!--删除门店信息-->
    <update id="deleteShop" parameterType="com.xzsd.pc.shop.entity.ShopInfoF">
        update t_shop
        set
        is_delete = 1,
        last_modify_by = #{byUserId},
        modify_time = now(),
        version = version + 1
        where
        <foreach item="item" index="index" collection="listId" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>

    <!--查询门店信息列表-->
    <select id="listShop" parameterType="com.xzsd.pc.shop.entity.ShopInfoF" resultType="com.xzsd.pc.shop.entity.ShopInfoV">
        select
        shop_id shopId,
        shop_name shopName,
        phone,
        address,
        shoppower_id shppowerId,
        invitation_id invitationId,
        user_acct userAcct
        from t_shop as a left join t_sys_user as b
        on a.shoppower_id = b.user_id
        where
        is_delete = 0
        <if test="shopId != null and shopId != ''">
            and shop_id = #{shopId}
        </if>
        <if test="shopName != null and shopName != ''">
            and shop_name = #{shopName}
        </if>
        <if test="provinceValue != null and provinceValue != ''">
            and province_value = #{provinceValue}
        </if>
        <if test="cityValue != null and cityValue != ''">
            and city_value = #{cityValue}
        </if>
        <if test="countyValue != null and countyValue != ''">
            and county_value = #{countyValue}
        </if>
    </select>

    <!--查询门店详情-->
    <select id="getShopInfoById" parameterType="java.lang.String" resultType="com.xzsd.pc.shop.entity.ShopInfoV">
        select
        shop_id shopId,
        shop_name shopName,
        phone,
        address,
        shoppower_id shppowerId,
        invitation_id invitationId,
        user_acct userAcct
        from t_shop as a left join t_sys_user as b
        on a.shoppower_id = b.user_id
        where
        is_delete = 0
        and shop_id = #{shopId}
    </select>
</mapper>